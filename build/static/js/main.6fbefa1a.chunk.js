(this["webpackJsonpwhatsapp-clone"]=this["webpackJsonpwhatsapp-clone"]||[]).push([[0],{104:function(e,t,a){},105:function(e,t,a){},106:function(e,t,a){},107:function(e,t,a){},134:function(e,t,a){},135:function(e,t,a){},136:function(e,t,a){"use strict";a.r(t);var c=a(4),n=a(1),s=a.n(n),i=a(14),r=a.n(i),o=(a(104),a(92)),d=a(20),j=(a(105),a(81)),l=a.n(j),u=a(86),b=a.n(u),h=a(85),m=a.n(h),O=a(87),p=a.n(O),f=a(164),x=a(172),v=a(165),g=(a(106),a(107),a(46)),_=g.a.initializeApp({apiKey:"AIzaSyC0kI1tjP9BITnQ7UX-WijmQOSHCYl8B1o",authDomain:"whatsapp-clone-edaa5.firebaseapp.com",projectId:"whatsapp-clone-edaa5",storageBucket:"whatsapp-clone-edaa5.appspot.com",messagingSenderId:"348304486559",appId:"1:348304486559:web:a286178e15a17288c1b2aa",measurementId:"G-GLPZ5CZWS9"}).firestore(),N=g.a.auth(),S=new g.a.auth.GoogleAuthProvider,w=_,C=a(39);var y=function(e){var t,a=e.id,s=e.name,i=e.addNewChat,r=Object(n.useState)(""),o=Object(d.a)(r,2),j=o[0],l=o[1],u=Object(n.useState)([]),b=Object(d.a)(u,2),h=b[0],m=b[1];return Object(n.useEffect)((function(){a&&w.collection("rooms").doc(a).collection("messages").orderBy("timestamp","desc").onSnapshot((function(e){return m(e.docs.map((function(e){return e.data()})))}))}),[a]),Object(n.useEffect)((function(){l(Math.floor(5e3*Math.random()))}),[]),i?Object(c.jsx)("div",{onClick:function(){var e=prompt("Please enter a name for chatroom");e&&w.collection("rooms").add({name:e})},className:"sidebarChat",children:Object(c.jsx)("h2",{children:"Add new chat"})}):Object(c.jsx)(C.b,{to:"/rooms/".concat(a),children:Object(c.jsxs)("div",{className:"sidebarChat",children:[Object(c.jsx)(x.a,{src:"https://avatars.dicebear.com/api/human/".concat(j,".svg")}),Object(c.jsxs)("div",{className:"sidebarChat__info",children:[Object(c.jsx)("h2",{children:s}),Object(c.jsx)("p",{children:null===(t=h[0])||void 0===t?void 0:t.message})]})]})})},I=Object(n.createContext)(),E=function(e){var t=e.reducer,a=e.initialState,s=e.children;return Object(c.jsx)(I.Provider,{value:Object(n.useReducer)(t,a),children:s})},k=function(){return Object(n.useContext)(I)};var A=function(){var e=k(),t=Object(d.a)(e,2),a=t[0].user,s=(t[1],Object(n.useState)([])),i=Object(d.a)(s,2),r=i[0],o=i[1];return Object(n.useEffect)((function(){var e=w.collection("rooms").onSnapshot((function(e){return o(e.docs.map((function(e){return{id:e.id,data:e.data()}})))}));return function(){e()}}),[]),Object(c.jsxs)("div",{className:"sidebar",children:[Object(c.jsxs)("div",{className:"sidebar__header",children:[Object(c.jsx)(f.a,{children:Object(c.jsx)(x.a,{src:null===a||void 0===a?void 0:a.photoURL})}),Object(c.jsxs)("div",{className:"sidebar__headerRight",children:[Object(c.jsx)(f.a,{children:Object(c.jsx)(m.a,{})}),Object(c.jsx)(f.a,{children:Object(c.jsx)(b.a,{})}),Object(c.jsx)(f.a,{children:Object(c.jsx)(p.a,{})})]})]}),Object(c.jsx)("div",{className:"sidebar__search",children:Object(c.jsxs)("div",{className:"sidebar__searchContainer",children:[Object(c.jsx)(v.a,{}),Object(c.jsx)("input",{type:"text",placeholder:"Search chatrooms.."})]})}),Object(c.jsxs)("div",{className:"sidebar__chats",children:[Object(c.jsx)(y,{addNewChat:!0}),r.map((function(e){return Object(c.jsx)(y,{id:e.id,name:e.data.name},e.id)}))]})]})},P=a(69),B=a.n(P),T=a(88),U=a(166),D=a(171),L=a(173),M=a(170),R=a(167),W=a(168),F=a(169),G=a(89),J=a.n(G).a.create({baseURL:"http://localhost:9000"}),z=a(90),Q=a.n(z),Z=(a(134),a(17));var H=function(e){var t,a,s=e.id,i=k(),r=Object(d.a)(i,2),o=r[0].user,j=(r[1],Object(n.useState)("")),l=Object(d.a)(j,2),u=l[0],b=l[1],h=Object(n.useState)(""),m=Object(d.a)(h,2),O=m[0],p=m[1],_=Object(Z.f)().roomId,N=Object(n.useState)(""),S=Object(d.a)(N,2),C=S[0],I=S[1],E=Object(n.useState)([]),A=Object(d.a)(E,2),P=A[0],G=A[1],z=Object(n.useState)([]),H=Object(d.a)(z,2),K=H[0],V=H[1];Object(n.useEffect)((function(){s&&w.collection("rooms").doc(s).collection("messages").orderBy("timestamp","desc").onSnapshot((function(e){return G(e.docs.map((function(e){return e.data()})))}))}),[s]),Object(n.useEffect)((function(){var e=w.collection("rooms").onSnapshot((function(e){return V(e.docs.map((function(e){return{id:e.id,data:e.data()}})))}));return function(){e()}}),[]),Object(n.useEffect)((function(){_&&(w.collection("rooms").doc(_).onSnapshot((function(e){return I(e.data().name)})),w.collection("rooms").doc(_).collection("messages").orderBy("timestamp","asc").onSnapshot((function(e){return G(e.docs.map((function(e){return e.data()})))})))}),[_]),Object(n.useEffect)((function(){p(Math.floor(5e3*Math.random()))}),[_]);var X=function(){var e=Object(T.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,J.post("/api/messages/new",{message:u,name:"User",timestamp:"Just now",received:!1});case 3:w.collection("rooms").doc(_).collection("messages").add({message:u,name:o.displayName,timestamp:g.a.firestore.FieldValue.serverTimestamp()}),b("");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.jsxs)("div",{className:"chat",children:[Object(c.jsxs)("div",{className:"chat__header",children:[Object(c.jsx)("div",{className:"avatar",children:Object(c.jsx)(x.a,{src:"https://avatars.dicebear.com/api/human/".concat(O,".svg")})}),Object(c.jsxs)("div",{className:"chat__headerInfo",children:[Object(c.jsx)("h3",{children:C}),Object(c.jsxs)("p",{children:["Last Seen "," ",new Date(null===(t=P[P.length-1])||void 0===t||null===(a=t.timestamp)||void 0===a?void 0:a.toDate()).toUTCString()]})]}),Object(c.jsxs)("div",{className:"chat__headerInfoMobile",children:[Object(c.jsx)(f.a,{children:Object(c.jsx)(x.a,{src:null===o||void 0===o?void 0:o.photoURL})}),Object(c.jsx)(U.a,{className:"app__dropdown",children:Object(c.jsx)(D.a,{variant:"outlined",value:C,children:K.map((function(e){return Object(c.jsx)(L.a,{value:e.data.name,children:Object(c.jsx)(y,{id:e.id,name:e.data.name},e.id)})}))})}),Object(c.jsx)("div",{onClick:function(){var e=prompt("Please enter a name for chatroom");e&&w.collection("rooms").add({name:e})},className:"mobileChatAdd",children:Object(c.jsx)("h2",{children:"Add new chat"})})]}),Object(c.jsxs)("div",{className:"chat__headerRight",children:[Object(c.jsx)(f.a,{children:Object(c.jsx)(v.a,{})}),Object(c.jsx)(f.a,{children:Object(c.jsx)(R.a,{})}),Object(c.jsx)(f.a,{children:Object(c.jsx)(W.a,{})})]})]}),Object(c.jsx)("div",{className:"chat__body",children:P.map((function(e){var t;return Object(c.jsxs)("p",{className:"chat__message ".concat(e.name===o.displayName&&"chat__receiver"),children:[Object(c.jsxs)("span",{className:"chat__name",children:[e.name,": "]}),e.message,Object(c.jsx)("span",{className:"chat__timestamp",children:new Date(null===(t=e.timestamp)||void 0===t?void 0:t.toDate()).toUTCString()})]})}))}),Object(c.jsxs)("div",{className:"chat__footer",children:[Object(c.jsx)(f.a,{children:Object(c.jsx)(F.a,{})}),Object(c.jsxs)("form",{children:[Object(c.jsx)("input",{value:u,onChange:function(e){return b(e.target.value)},placeholder:"Type a message..",type:"text"}),Object(c.jsx)("div",{className:"form__button",children:Object(c.jsx)(M.a,{onClick:X,type:"submit",children:"Send message"})})]}),Object(c.jsx)("div",{className:"mic__button",children:Object(c.jsx)(f.a,{children:Object(c.jsx)(Q.a,{})})})]})]})},K=a(91),V=(a(135),a(70)),X="SET_USER",Y=function(e,t){switch(console.log(t),t.type){case X:return Object(V.a)(Object(V.a)({},e),{},{user:t.user});default:return e}};var q=function(){var e=k(),t=Object(d.a)(e,2);Object(K.a)(t[0]);var a=t[1];return Object(c.jsx)("div",{className:"login",children:Object(c.jsxs)("div",{className:"login__container",children:[Object(c.jsx)("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/150px-WhatsApp.svg.png",alt:""}),Object(c.jsx)("div",{className:"login__text",children:Object(c.jsx)("h1",{children:"Sign in to WhatsApp"})}),Object(c.jsx)(M.a,{type:"submit",onClick:function(){N.signInWithPopup(S).then((function(e){a({type:X,user:e.user})})).catch((function(e){return alert(e.message)}))},children:"Sign in with Google"})]})})};var $=function(){var e=k(),t=Object(d.a)(e,2),a=t[0].user,s=(t[1],Object(n.useState)([])),i=Object(d.a)(s,2),r=i[0],j=i[1];return Object(n.useEffect)((function(){J.get("/api/messages/all").then((function(e){j(e.data.results)}))}),[]),Object(n.useEffect)((function(){var e=new l.a("4eefa8127dd75938c541",{cluster:"us2"}).subscribe("messages");return e.bind("inserted",(function(e){j([].concat(Object(o.a)(r),[e]))})),function(){e.unbind_all(),e.unsubscribe()}}),[r]),console.log("Messages: ",r),Object(c.jsx)("div",{className:"app",children:a?Object(c.jsx)("div",{className:"app__body",children:Object(c.jsxs)(C.a,{children:[Object(c.jsx)(A,{}),Object(c.jsxs)(Z.c,{children:[Object(c.jsx)(Z.a,{path:"/rooms/:roomId",children:Object(c.jsx)(H,{})}),Object(c.jsx)(Z.a,{path:"/",children:Object(c.jsx)(H,{})})]})]})}):Object(c.jsx)(q,{})})},ee=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,175)).then((function(t){var a=t.getCLS,c=t.getFID,n=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),c(e),n(e),s(e),i(e)}))};r.a.render(Object(c.jsx)(s.a.StrictMode,{children:Object(c.jsx)(E,{initialState:{user:null},reducer:Y,children:Object(c.jsx)($,{})})}),document.getElementById("root")),ee()}},[[136,1,2]]]);
//# sourceMappingURL=main.6fbefa1a.chunk.js.map